---
title: 推薦アルゴリズムの概要
AI: "false"
published: 
description: 
tags:
  - permanent-note
  - recommend
  - oreilly
---
---
[[oreilly-978-4-87311-966-3e 2.pdf]]
```table-of-contents
```
## 推薦アルゴリズムの分類

推薦アルゴリズムのアルゴリズムは下記のような分類で説明されることが多い。
- 内容ベースフィルタリング(content-based filtering)
- 協調フィルタリング(collaborative filtering)
	- メモリベース法(memory-based method)
	- モデルベース法(model-based method)
**メモリベース法**では、推薦システムが利用されるまではシステム内のユーザーのデータを蓄積するのみで予測のための計算は行わず、推薦を行うタイミングで蓄積されたデータのうち必要なものすべてを用いて予測計算を行う。
**モデルベース法**では、推薦システムが利用される以前にあらかじめシステム内で蓄積されたデータの規則性を学習したモデルを作成しておき、予測時には事前に作成されたモデルと推薦を提供する対象のユーザーのデータのみを利用して計算を行う。

## 内容ベースフィルタリング

内容ベースフィルタリングは、ユーザーがどのような内容のアイテムを好むかを表す**ユーザープロファイル(user profile)** と、アイテムのさまざまな性質を表す特徴を抜き出した**アイテム特徴(item feature)** との一致度、つまり類似度を計算することで、好みに合ったアイテムをユーザーに推薦するアルゴリズム。

ユーザーのアイテムの内容への好みを表すユーザープロファイルの獲得には、大きく2つの方法がある。

1. ユーザーの過去の行動履歴に基づいてユーザープロファイルを作成する**間接指定型**
![[Pasted image 20250608195809.png]]

2. ユーザーに自身が好きなアイテムの特徴を明示的に指定してもらう**直接指定型**
![[Pasted image 20250608195948.png]]

## 協調フィルタリング

メモリベース法は、推薦を受け取るユーザーと好みが似ているユーザーに着目して推薦を行う**ユーザー間型メモリベース法(user-user memory-based method)** と、推薦を受け取るユーザーが好むアイテムと似ているアイテムに着目して推薦を行う**アイテム間型メモリベース法(item-item memory-based method)** に分けられる。

#### メモリベース法のアルゴリズム概要
ユーザー間型メモリベース法では、まず推薦を受け取るユーザーと似ているユーザー群を探す。探し方は、主に購買履歴を参考に類似度から得る。そのユーザー群が好むアイテムを推薦を受け取るユーザーに推薦する。
→ アイテムの具体的な属性情報を利用しないのは協調フィルタリングの大きな特徴。
#### 嗜好データの獲得と評価値行列
ユーザーからアイテムへの好みの情報を**嗜好データ(preference data)** という。嗜好データを獲得する方法は大きく2つあり、**明示的獲得(explicit feedback)** と **暗黙的獲得(implicit feedback)** である。
【明示的獲得】
- 5段階評価でのアイテムレビュー
- 好きなアイテムジャンルの回答
→ ユーザー自身に回答してもらう
【暗黙的獲得】
- 購入
- お気に入り登録
- 閲覧
→ サービス内におけるユーザーの行動履歴からアイテムに対する関心を推定する

典型的な推薦システムの問題設定では、評価値行列が与えられたうえで対象ユーザーのあるアイテムへの未知の評価値を予測計算することになる。
#### モデルベース法のアルゴリズム概要
予測に使うモデルには、
- クラスタリングを使ったモデル
- 回帰問題や分類問題として評価値を直接予測するモデル
	- 回帰モデルを利用して学習することで予測
- トピックモデルを利用するもの
	- LDA(Latent Dirichlet Allocation)などの手法を適用して評価値行列を次元圧縮することで、「SFが好き」などの潜在的な意味を表現する情報を獲得して推薦に用いる
- 行列分解を利用するもの
などさまざま。
#### メモリベース法とモデルベース法の協調フィルタリングの比較
【推薦にかかる時間】
<u>メモリベース法</u>
　推薦時に毎回すべてのデータを使って似ているユーザーやアイテムを探してから、それらを用いて予測を行うため**時間がかかってしまう**
<u>モデルベース法</u>
　事前にデータの規則性を捉えたモデルを作成しているため、作成済みモデルを利用した予測だけ行えばすぐに推薦を行うことが出来るので**時間がかからない**
【運用性】
<u>メモリベース法</u>
　推薦のたびに毎回すべてのデータを利用するので特別な考慮なく、**最新のデータを反映させた推薦を行うことになる**
<u>モデルベース法</u>
　ユーザーやアイテムのデータに変更があり、その変更を活かしたい場合は再度モデルを作り直す必要があるため、**モデルの更新タイミングや再学習にかかる計算コストなどを考える必要があり、運用が比較的難しい**
　
## 内容ベースフィルタリングと協調フィルタリングの比較

![[Pasted image 20250609160703.png]]
#### 多様性の向上
多様性とは、推薦結果に含まれるアイテムが似ていないこと。多様性を高めたい場合は、内容ベースフィルタリングよりも協調フィルタリングの方が有効。内容ベースフィルタリングの場合は、推薦を受け取るユーザーのプロファイルはそのユーザーが知らない作者やジャンルの情報を反映することが出来ないからである。
#### ドメイン知識を扱うコスト
ドメイン知識 ... 本のジャンルや出版社、ユーザーの性別や年齢といったサービス内のアイテムやユーザー固有の知識・コンテキスト

ドメイン知識を適切に扱ったり管理したりするコストの観点でいえば、**協調フィルタリングの方が低コスト。** 協調フィルタリングについては、ドメイン知識がなくともユーザーの行動履歴があれば良い推薦ができる。
前提として、さまざまなドメ イン知識を管理するデータベースの維持管理は高コストであることと、そのドメイン 知識をうまく扱えなければ良い推薦ができないということ自体も大きなコスト。

#### コールドスタート問題への対応
コールドスタート問題 ... **サービス内でのユーザーやアイテムに関する情報が少ないケース**、特に新規ユーザーや新規アイテムについて適切に推薦を行うことが難しいという問題。

コールドスタート問題への対応という観点では、内容ベースフィルタリングのほうが望ましい性質を持っていると言える。

協調フィルタリング
- ユーザーの過去の嗜好のデータがなければ、嗜好の似ているユーザーを探すことが難しい。
- 新規アイテムについても、ユーザーからの嗜好データが集まっていなければ、協調フィルタリングで推薦を行うことはできない。

内容ベースフィルタリング
- 新規ユーザーであっても明示的にアイテムへの嗜好を入力してもらうことができれば(これも壁ではあるが)、最初からユーザーが関心を持ちそうなアイテムを推薦することが出来る
#### ユーザー数が少ないサービスにおける推薦
この点では内容ベースフィルタリングの方が望ましい性質を持っている。

協調フィルタリングの場合、ユーザー数が少ないと十分に似ているユーザーを獲得したり、似ているユーザーの行動履歴から推薦対象のユーザーが関心を持つであろうアイテムを特定することが難しい。良い推薦を行うことが出来ないと、ユーザー数が増えないため悪い流れになる。

内容ベースフィルタリングの場合、アイテム特徴やユーザープロファイルさえ獲得することが出来れば推薦を行うことが出来るため、**システム内にユーザーがどれくらいいるかということはあまり推薦に関係ない。**
#### 被覆率
被覆率(coverage)とは、**サービスにあるすべてのアイテムのうち、推薦システムでユーザーに推薦することができるアイテムの割合**のこと。

システム内の他のユーザーの行動履歴をもとに推薦を行う協調フィルタリングでは、推薦を受け取るユーザーと似ているユーザーが誰も試していない、つまり評価していないアイテムについては推薦することができない。この点において、**サービスにあるアイテムのうち推薦できるアイテムは限られたものになってしまう。**

内容ベースフィルタリングでは、システム内のユーザーのユーザープロファイルと関連するアイテム特徴を有するアイテムであれば**サービスに存在するどのアイテムでも推薦することが出来る。**
#### アイテム特徴の活用
この観点では、内容ベースフィルタリングが望ましい性質を持っている。

協調フィルタリングではユーザーの過去の嗜好データのみに基づいて推薦を行うので、**アイテムの属性情報を基本的に考慮することが出来ない。**
#### 予測精度
ある程度の規模のサービスにおいて、多数派である一定以上アクティブにサービスを利用している一般的な嗜好傾向を持つユーザーに対する推薦を仮定する。この場合、**内容ベースフィルタリングよりも協調フィルタリングのほうが高い精度で予測を行うことが出来る**と一般的に言われている。

## 推薦アルゴリズムの選択

前提として、これら 2 つのアルゴリズムからどちらか一方のみを選択しなければならないわけではなく、 **適切に組み合わせたハイブリッドな手法を取ることが多い。** また、1 つのシステムに対して1つのアルゴリズムだけを適用するというわけでもなく、ユーザーやアイテムの状況に応じて複数のアルゴリズムを使い分けたり変化させたりする必要がある。

そのため、データが少ない新規サービスにおける推薦や、ある程度の規模のサービスでも新規ユーザーへの推薦や新規アイテムを推薦したい際には、内容ベースフィルタリングを選択することが多い。一方で、ある程度ユーザー数が増えたりユーザーやアイテムごとのデータが蓄積されたあとは、より複雑なユーザーの嗜好を表現可能な協調フィルタリングのほうが高い精度でアイテムを推薦できることが多い。

嗜好品などの、**欲しいものが明確に決まっているわけではないアイテムに関しては、多様性が重要になる**ケースが多い。明確に決まっていないアイテムに関しては、堅実にユーザーが欲しいものを推薦できる直接指定型の内容ベースフィルタリングを利用した方が良い。

## 嗜好データの特徴

#### 明示的獲得と暗黙的獲得の比較
嗜好データの獲得方法には明示的獲得と暗黙的獲得の2つがあった。

【データ量】
一般的には暗黙的獲得の方が圧倒的に多くの嗜好データを入手することが出来る。
たとえばユーザーが10件の商品情報を閲覧した場合は、10件のアイテムに対するユーザーの嗜好データを獲得することもできる。

【データの正確さ】
明示的獲得の方がユーザーの嗜好を反映している傾向が強い。
暗黙的獲得で正確な嗜好データを獲得するためには、サービスやデータの特性を見極めたうえで適切な条件を設定したユーザーの行動を定義する必要がある。

【未評価と不支持の区別】
明示的獲得においては、ユーザーがアンケートやレビューに回答していない場合は未評価であり、回答が否定的であった場合は不支持と明確に区別できる。
一方、**暗黙的獲得においては未評価と不支持の区別が一般的に困難で不明瞭**である。例えば、推薦されたうえでチェックしていないアイテムは未評価なのか不支持なのかの区別をつけるのが難しい。この場合は、たとえば3回推薦されたがチェックしなかった場合に不支持とする、といった適当な条件を設定することで、未評価と不支持を区別するなどが考えられる。

【ユーザーの認知】
ユーザーの認知とは、ユーザーが自身の嗜好データをいつ、どのように取得されて利用されているのかを知っているかということ。この観点ではもちろん、ユーザーが自ら質問に回答することで嗜好データをシステムに与えている明示的獲得の方が優れている。
#### 嗜好データを扱う際の注意点
【データのスパース性】
データがスパースである ... 評価値行列の成分である評価値のほとんどが未評価な状態
ユーザーに対してアイテムが膨大な場合はシンプルに未評価であることが多いが、それ以外にも**人気アイテムに偏り、人気でないアイテムに評価が集まらない**こともある。また、サービスの性質によっても評価値の埋まり具合は異なる。例えば住宅と音楽では、評価値の集まり具合がかなり異なる。

【評価値の揺らぎやバイアス】
たとえ同じユーザーが同一のアイテムに対してレビューを行って評価値を与えるとしても、少し時間をおいて再度レビューを行った場合、その評価値が同じになるとは限らない。これを**評価値の揺らぎ**と呼ぶ。
また、推薦システムの嗜好データにはさまざまなバイアスが存在する。ユーザーは自分が気に入ったものにしか評価をつけないことが多いという傾向が明らかになっている。他には、**人気バイアス**がある。すべてのアイテムが平等に評価される機会を与えられているわけではなく、ユーザーによる嗜好データは人気のアイテムに集まりやすい。ユーザーによっては高い評価を付けがちな人、低い評価を付けがちな人もいたりする。






