---
title: Linux講座中級第7回
AI:
published: 2025-09-12
description:
tags:
  - permanent-note
---
**Linux講座**
- https://engineer-ninaritai.com/infraacademy/course-category/linux/?loop_content_only=false&column_per_row=3&course_per_page=12&show_pagination=false&keyword=Linux%E4%B8%AD%E7%B4%9A&tutor-course-filter-category=57&course_order=oldest_first&course_filter=true&loop_content_only=false&column_per_row=3&course_per_page=12&show_pagination=false&current_page=1&action=tutor_course_filter_ajax

---
##### ハードディスクとは？

まずは、ハードディスクについて学習を始めます。

そもそもハードディスクとは何なのでしょうか?

**ハードディスクとは、データを保存するための装置です。**

500GBや1TBなどの大容量のデータを保存しておくことができます。

ハードディスクのデータは、パソコンの電源をOFFにしても消えることはありません。

**不揮発性**のデバイスです。

ハードディスクは以下のような円盤があり、この円盤(磁器ディスク)にデータを保存します。
![[Pasted image 20250912004123.png]]

---
##### ハードディスクの接続形態

**ハードディスクを使用するには、PCと接続する必要があります。**

ハードディスクを接続する形態については、いくつか種類があります。

###### SATA(サタ)

SATA(シリアルATA)は、一般的なPCで使用されるインターフェースです。SATAは、サタと呼ばれます。

PCのマザーボードとハードディスクを接続します。

シリアル通信を基盤にしており、データの転送速度は比較的高速です。

SATA接続は安価で一般的であり、ほとんどの一般的なハードディスクやSSDがこのインターフェースを使用しています。
![[Pasted image 20250912004152.png]]

###### SAS(サス)

SASは、複数のデバイスを接続し、高い通信品質と冗長性を提供します。

**データセンターやサーバ環境での利用が一般的**で、高いスループットと信頼性が求められる場合に選ばれます。

###### SCSI(スカジー)

SCSIは、ハードディスクやDVDドライブなどさまざまな周辺機器を接続するためのインターフェースです。

接続には、以下のような8本あるいは16本の銅線を並行に束ねたパラレルのSCSIケーブルを使用します。
![[Pasted image 20250912004233.png]]

ただ、一般的にはUSBを使って周辺機器と接続するので、見たことがない人もいるでしょう。

###### USB

USBは、**外部デバイスを接続するための汎用的なインターフェース**です。

USB接続は便利で広く利用されており、外付けハードディスクやフラッシュドライブなどが主に使用します。

**一般的な外付けハードディスクはUSBで接続されることが多いでしょう。**
![[Pasted image 20250912004249.png]]

---
##### デバイスファイル

ここからは、デバイスファイルについて解説します。

###### デバイスファイルとは？

デバイスファイルとは、**ハードディスクやDVD、USBメモリなどのデバイスへデータのやり取りを行うためのファイル**です。
![[Pasted image 20250912004331.png]]

例えば、USBメモリへ接続したい場合は、デバイスファイルの/dev/sdbへアクセスします。

このように、デバイスをファイルとして認識して、Linuxからアクセスできるようにします。

ただ、デバイスファイルはデバイスへのデータのやり取りを行うためのファイルと記載しましたが、直接ファイルのコピーなどはできません。

理由は、後に解説する**ファイルシステム**が無いからです。ファイルシステムを指定することで、USBメモリなどのデバイスにfile.txtをコピーするといった操作ができるようになります。

###### デバイスファイルの一覧

デバイスファイルは通常**`/dev`**ディレクトリに格納されています。以下は一般的なLinuxシステムで見られる主なデバイスファイルの一覧です。

|デバイスファイル|説明|
|---|---|
|/dev/sda|最初のハードディスク全体|
|/dev/sda1|ハードディスクの1番目のパーティション|
|/dev/sda2|ハードディスクの2番目のパーティション|
|/dev/sdb|2番目のハードディスク全体|
|/dev/sdb1|2番目のハードディスクの1番目のパーティション|
|/dev/tty|現在の端末|
|/dev/tty0|仮想コンソール 1|
|/dev/tty1|仮想コンソール 1|
|/dev/tty2|仮想コンソール 2|
|/dev/null|ヌルデバイス（データを破棄する特別なファイル）|
|/dev/cdrom|CD-ROM ドライブ|
|/dev/dvd|DVD ドライブ|

/dev/sdaは、LinuxのOSなどが保存されたハードディスクを指します。/dev/sda1のパーティションについては後ほど詳しく解説します。

USBで接続した外部ハードディスクやUSBメモリは2番目のハードディスクとして認識されます。つまり、/dev/sdbとして認識されます。

---
##### Linuxでハードディスクを利用するまでの流れ

前回まで、デバイスファイルについて解説しました。

ここからは、Linuxでハードディスクを利用できるようになるまでの流れを解説します。

Linuxでハードディスクを利用するには、以下のような流れがあります。

1. ハードディスク内にパーティションと呼ばれる区画を作る
2. ファイルシステムとLinuxのディレクトリを割り当てる(マウント)

さらに詳しく解説します。

###### パーティションの作成

まず、ハードディスクをパーティションと呼ばれる区画ごとに分割します。

以下の図のように、ハードディスクの全体をパーティション1、パーティション2と分割します。
![[Pasted image 20250912004506.png]]

**/dev/sdaや/dev/sda1はデバイスファイルです。**

Linuxに接続した段階でデバイス(ハードディスク)に対して割り当てられます。

###### ファイルシステムの作成

次に**ファイルシステム**を割り当てます。

ファイルシステム（File System）は、データを格納し、管理するための方法を提供します。

例えば 、”cp file.txt testdir”や”cat file.txt”のように、ファイルとして操作できるのはファイルシステムがあるからです。

もしファイルシステムがない場合は、”ハードディスクの189345番セクタのデータを9324934番セクタにコピーする”といった操作が必要になります。

以下のようにデバイスファイルに対して、ファイルシステムとLinuxのディレクトリを割り当てます。

例えば、/dev/sda1にext4のファイルシステムと/(ルートディレクトリ)を割り当てます。
![[Pasted image 20250912004651.png]]

上記のように割り当てることで、/(ルートディレクトリ)へ保存したデータがハードディスクのパーティション1へ保存されます。

また、デバイスファイルにファイルシステム、Linuxのディレクトリを割り当ていることを**マウント**と言います。

次に、パーティション、ファイルシステム、マウントの詳しい概要や操作について解説します。

---
##### パーティションとは？

前回は、ハードディスクを利用する流れについて解説しました。

ハードディスクをLinuxで利用するには、以下の流れが必要です。

1. **ハードディスク内にパーティションと呼ばれる区画を作る**
2. ファイルシステムとLinuxのディレクトリを割り当てる(マウント)

今回は、1のパーティションについて詳しく解説します。

###### パーティションとは？

パーティションは、コンピュータのストレージデバイス（ハードディスクドライブやSSDなど)を**論理的に分割した区画のことです。**

これにより、**物理的なディスクを複数の論理的なセクションに分けて、それぞれを独立して利用できるようになります。**
![[Pasted image 20250912004756.png]]

パーティションによって、**さまざまなメリット**があります。

例えば、オペレーティングシステムとデータを別々のパーティションに格納することで、

システムの安定性やバックアップの管理がしやすくなります。

パーティションはディスクの効率的な利用、データの保護、異なる用途への分離など、さまざまな目的に利用されます。

しかし、パーティションを操作する際には注意が必要で、誤って削除するとデータが失われる可能性があるため、慎重に行うことが重要です。

パーティションはLinuxインストール時に設定することができます。

以下は、Linuxのインストール時のパーティションの設定です。
![[Pasted image 20250912004818.png]]

Linuxのインストール時は、パーティションを分割して、Linuxのデータを保存する場所や仮想メモリの場所などを作成します。

---
##### パーティションの種類

パーティションには、3つの種類があります。

- **基本パーティション(プライマリパーティション)**
- **拡張パーティション**
- **論理パーティション**

今回は、3つのパーティションの種類について解説します。

###### 基本パーティション

基本パーティション(プライマリパーティション)は、**ディスク上で最初に作成されるパーティションで、通常はオペレーティングシステムをインストールするために使用されます。**

一つのディスクには最大で4つの基本パーティションを作成できます。

ハードディスク/dev/sdaでは、**/dev/sda1~/dev/sda4が基本パーティション**に当たります。
![[Pasted image 20250912004933.png]]

###### 拡張パーティション

基本パーティションの１つを拡張パーティションにすることができます。

拡張パーティションには、後述する論理パーティションが格納されます。

###### 論理パーティション

論理パーティションは、拡張パーティション内に作成され、それぞれが独立したファイルシステムを持ちます。

一つの拡張パーティションには複数の論理パーティションを作成できます。

論理パーティションのデバイスファイルは、基本パーティションの数に関わらず、/dev/sda5から始まります。
![[Pasted image 20250912004953.png]]

---
##### ファイルシステムとは？

前回まで、パーティションについて解説しました。

パーティションは、ハードディスクを分割した区画のことです。

パーティションを作っただけでは、ファイルを作成したり、編集したりすることはできません。

そこで、**ファイルシステム**という仕組みを利用します。

**ファイルシステムとは、ファイルとしてディスク上のデータを取り扱う仕組みのことです。**

ハードディスクは、セクタと呼ばれる単位で、ディスク上の区画を区別します。

もしファイルシステムが無い場合、ディスク上のデータを読み取る場合は、”89435セクタのデータを読み取る”という制御を行う必要があります。

ファイルシステムがあると、”/etc/ディレクトリのfile.txtを読み取る”のようにファイルでデータの読み取りなどを行うことができます。

---
##### ファイルシステムの種類

ファイルシステムは、ハードディスクなどにファイルとしてデータのやり取りを行う仕組みです。

**Linuxでは、さまざまな種類のファイルシステムを扱うことができます。**

**現在多く使われているのは、ext4です。**

###### ファイルシステムの一覧

そのほかには、以下のようなファイルシステムがあります。

|ファイルシステム|説明|
|---|---|
|ext2|Linuxの古いファイルシステムで、メタデータの耐久性が低い。|
|ext3|ext2の後継で、ジャーナリングファイルシステムをサポート。|
|ext4|Linuxで広く使用されているファイルシステム。高性能で耐久性あり。|
|XFS|スケーラビリティが高く、大容量ファイルシステムに適している。|
|Btrfs|サポートが向上しているコピーオンライトファイルシステム。|
|ZFS|高度なデータ管理機能を備えたファイルシステム。|
|FAT|単純なファイルシステムで、主にリムーバブルデバイスで使用。|

上記はLinuxで使われるファイルシステムですが、Windowsで使われるntfsやMacOSで使われるAPFSといったファイルシステムなどもあります。

---
##### mkfsコマンド

mkfsコマンドは、**パーティションにファイルシステムを作成することができるコマンド**です。

###### コマンドの使い方

mkfsコマンドの使い方は、以下の通りです。

```bash
mkfs -t [ファイルシステムの種類] [デバイスファイル]
```

“-t”オプションの後ろには、作成するファイルシステムの種類を指定します。例えば、ext4やext3などがあります。  
また、デバイスファイルは/dev/sda1などを指定します。

[シミュレータ](https://terminal.engineer-ninaritai.com/)で試してみましょう。

まず、デバイスファイルを使えるようにするために、以下のコマンドを実行します。

シミュレータでは、/dev/nvme0n1p127をスワップ領域(仮想メモリ)として使用しているので、それを停止させます。

```bash
swapoff /dev/nvme0n1p127
```

/dev/nvme0n1p127をext4ファイルシステムとして割り当てます。

```bash
mkfs -t ext4 /dev/nvme0n1p127
```

コマンドを実行すると、プロセスを進めるかの確認があるので、yを入力して進めます。
![[Pasted image 20250912005702.png]]

ファイルシステムを確認する場合は、以下のコマンドを実行します。

```bash
lsblk -f /dev/nvme0n1p127
```

コマンドを実行すると、ファイルシステムがext4になっていることが分かります。
![[Pasted image 20250912005715.png]]

##### mke2fsコマンド

mke2fsコマンドは、**Linuxのファイルシステムであるext2、ext3、ext4を作成するため**に使用されます。

###### mke2fsコマンドの使い方

mke2fsコマンドは、以下のように実行します。

```bash
mke2fs [オプション] [デバイスファイル]
```

**ext2ファイルシステムを作成する場合**は、以下のような実行します。

```bash
mke2fs /dev/nvme0n1p127
```

**ext3ファイルシステムを作成する場合**は、”-j”オプションを指定します。

```bash
mke2fs -j /dev/nvme0n1p127
```

**ext4ファイルシステムを作成する場合**は、”-t”オプションを指定します。mkfsと同様の使い方です。

```bash
mke2fs -t ext4 /dev/nvme0n1p127
```

前回同様、ファイルシステムを変更したら、以下のコマンドで確認してみましょう。

```bash
lsblk -f /dev/nvme0n1p127
```

---
##### mkswapコマンド

mkswapコマンドは、**Linuxシステムでスワップ領域（仮想メモリとして使用される領域）を作成するために使用**されます。

###### mkswapコマンドの使い方

mkswapコマンドは、以下のように使用します。

```bash
mkswap [デバイスファイル]
```

例えば、/dev/nvme0n1p127をスワップ領域にする場合は以下のように実行します。

```bash
mkswap /dev/nvme0n1p127
```

swapとして開始させるためには、swaponコマンドを実行します。

```bash
swapon /dev/nvme0n1p127
```

---
##### マウントとは？

ここからは、マウントについて解説します。

もう一度、ハードディスクをLinuxで利用する流れを確認します。

1. ハードディスク内にパーティションと呼ばれる区画を作る
2. **ファイルシステムとLinuxのディレクトリを割り当てる(マウント)**

**マウントは、デバイスにファイルシステムとLinuxのディレクトリを割り当てること**です。

具体的には、/dev/sda1のようなハードディスクのパーティションを、ファイルシステムext4で/(ルートディレクトリ)に割り当てることをマウントと言います。

マウントすることで、ハードディスクなどのデバイスにデータのやり取りが行えるようになります。

また、/(ルートディレクトリ)のような**マウントされるディレクトリをマウントポイント**と呼びます。

---
##### /etc/fstabファイル

マウントされる情報は、/etc/fstabファイルに記載されます。

###### /etc/fstabの中身

まず、[シュミレーターを起動](https://terminal.engineer-ninaritai.com/)をして/etc/fstabの中身を確認してみましょう。

```bash
cat /etc/fstab
```

/etc/fstabの中身を見ると、以下のようになっています。
![[Pasted image 20250912005908.png]]

これが、マウントする情報になっています。

上記では、**/dev/cdromをファイルシステムiso9660で/media/cdromにマウントする**という意味になります。

/etc/fstabの内容についてさらに解説します。

###### /etc/fstabの内容

/etc/fstabは以下のような内容が記載されています。
![[Pasted image 20250912005924.png]]

1. **デバイスファイル**　デバイスファイル名もしくはラベル名を指定します
2. **マウントポイント**　マウント先のディレクトリを指定します
3. **ファイルシステム**　ファイルシステムを指定します。ext4やext3などです。
4. **マウントオプション** マウントのオプションを指定します。
5. **dumpフラグ** 1であればdumpコマンドによるバックアップの対象になります
6. **fsckのチェック順序** Linux起動時にfsckのチェックをする順序を指定します。fsckはデバイスに不具合があった場合に自動で修復するコマンドです。

例えば、/dev/sdb2をext4で/homeにマウントする場合は、以下のように記述します。

```bash
/dev/sdb2 /home ext4 default 0 0
```

ただ、/etc/fstabに記述しただけではマウントされません。/etc/fstabに記述後にmountコマンドを実行することでマウントされます。

###### マウントオプションの一覧

/etc/fstabのマウントオプションには、以下のようなものがあります。

|オプション|説明|
|---|---|
|`defaults`|デフォルトのオプション（読み書き可能、デバイスファイル作成可、SUID/SGIDビット有効）。|
|`rw`|読み書き可能でマウント。|
|`ro`|読み取り専用でマウント。|
|`noexec`|バイナリファイルの実行を無効にする。|
|`nodev`|デバイスファイルの作成を無効にする。|
|`nosuid`|SUID/SGIDビットの有効性を無効にする。|
|`user`|一般ユーザーがマウントとアンマウントを実行できるようにする。|
|`users`|同じく一般ユーザーがマウントとアンマウントを実行できるが、デバイス所有者も変更できる。|
|`noauto`|自動マウントを無効にし、手動でマウントする必要がある。|
|`exec`|バイナリファイルの実行を許可する。|
|`defaults,noatime`|アクセス時間の更新を無効にし、I/Oパフォーマンスを向上させる。|
|`discard`|TRIM操作を有効にし、SSDのパフォーマンスを最適化する。|
|`relatime`|アクセス時間を更新するが、バックグラウンドで効率的に行う。|
|`nouser`|一般ユーザーによるマウントとアンマウントを無効にする。|
|`noacl`|ACL（Access Control Lists）を無効にする。|

---
##### マウントの実践

前回は、/etc/fstabの記述方法について解説しました。

ここからは、マウントを実践してみましょう。[シミュレーター](https://terminal.engineer-ninaritai.com/)を起動します。

###### ディレクトリの作成と/etc/fstabの編集

まずは、マウント先のディレクトリを作成しましょう。

```bash
mkdir /testdir
```

続いて、/etc/fstabファイルを編集します。

```bash
vi /etc/fstab
```

/etc/fstabファイルを開いたら、以下の一行を追加しましょう。

```bash
/dev/nvme0n1p1 /testdir xfs defaults 0 0
```

/dev/nvme0n1p1はシミュレーターのデバイスファイルです。通常のLinuxでは/dev/sdaや/dev/sdbなどが一般的な名前です。

xfsというファイルシステムで、/testdirディレクトリにマウントさせます。

続いて、mountコマンドを実行してマウントさせます。

###### mountコマンドの基本的な使い方

mountコマンドは以下のように使用します。

```bash
mount [オプション]
```

**“-a”オプションを使うことで、/etc/fstabに記載された情報を全てマウントします。**

以下のコマンドを実行しましょう。

```bash
mount -a
```

###### マウントの確認

マウントができているかどうかの確認は、オプションなしでmountコマンドだけ実行させます。

```bash
mount
```

コマンドを実行すると、以下のように表示されます。

![[Pasted image 20250912010230.png]]

先ほど/etc/fstabファイルに記述した内容がマウントされています。

このようにmountコマンドを使用します。

---
##### umountコマンド

前回は、mountコマンドを使ってマウントを実践しました。

今回は、マウントを解除するアンマウントについて解説します。

アンマウントをする場合は、umountコマンドを使います。

###### umountコマンドの使い方

**umountコマンドは、マウントされたファイルシステムやデバイスをアンマウント（取り外し）するために使用されます。**  
アンマウントすることで、ファイルシステムやデバイスが正しく切断され、データの安全性が確保されます。

umountコマンドは、以下のように使用します。

```bash
umount [デバイスファイルまたはマウントポイント]
```

前回マウントした/testdirのマウントを解除する場合は、以下のように実行します。

```bash
umount /testdir
```

デバイスファイルを指定してもアンマウントできます。

```bash
umount /dev/nvme0n1p1
```

このようにumountコマンドを使って、アンマウントします。

マウントが解除されたかどうかは、mountコマンドを実行して、マウントの状況を確認してみましょう。

---
##### dfコマンド

ここからは、ディスクやデバイスなどに関連したコマンドを解説します。

まずは、dfコマンドについてです。

**dfコマンドは、特定のファイルシステムやディスクパーティションの使用容量、空き容量、およびその他の関連情報を表示します。**

###### dfコマンドの基本的な使い方

dfコマンドの基本的な使い方は以下の通りです。

```bash
df [オプション] [ファイルシステムまたはディレクトリ]
```

[シュミレーターを起動](https://terminal.engineer-ninaritai.com/)してコマンドを入力してみましょう。  
例えば、/homeディレクトリの空き容量を表示する場合は以下のように実行します。

```bash
df /home
```

コマンドを実行すると、/homeのファイルシステムや使用率などの情報が表示されます。
![[Pasted image 20250912010325.png]]

###### dfコマンドのオプション

dfコマンドのオプションには、以下のようなものがあります。

|オプション|説明|
|---|---|
|-h|人間に読みやすい形式で表示。サイズをKB、MB、GBに変換。|
|-T|ファイルシステムのタイプを表示。|
|-a|隠れているファイルシステムも含めてすべて表示。|
|-i|インデックスノード（inode）の情報を表示。|
|-t|指定したファイルシステムタイプの情報のみ表示。|

ファイルシステムやディレクトリを指定しないで、dfコマンドを実行すると、マウントされているファイルシステム全てを表示します。

また、**“-h”オプションを使うと、サイズを読みやすい形式で表示します。**

```bash
df -h
```

Sizeの部分で、10Mや256Gなど見やすく表示されています。
![[Pasted image 20250912010345.png]]

また、**“-i”オプションを付けるとiノードの使用状況を表示します。**

**iノードとは、ファイルやディレクトリの権限や所有者などの情報を保存しておく場所**のことです。

```bash
df -i
```

コマンドを実行すると、IUsedやIFreeなどiノードの使用状況が表示されます。
![[Pasted image 20250912010402.png]]

ファイルの中身とファイルの情報は別々に保存されます。ファイルの中身はハードディスクのデータブロックに、ファイルの情報はiノードブロックに保存されます。

iノードブロックが枯渇すると、ハードディスクに容量が残っていても、ファイルが作成できなくなります。

このようにdfコマンドを使用します。

---
##### duコマンド

duコマンドは、**ディスクの使用量をディレクトリごとに集計して表示するコマンドです。**

###### duコマンドの使い方

duコマンドは、以下のように使用します。

```bash
du [ディレクトリ名]
```

例えば、/etcの使用状況を表示する場合は、以下のように実行します。

```bash
du /etc
```

コマンドを実行すると、以下のように表示されます。/etcディレクトリ配下のディレクトリと容量が表示されます。
![[Pasted image 20250912010458.png]]

ただ、オプションを指定しないと単位などが分からないので、オプションと組み合わせて使用します。

###### duコマンドのオプション

duコマンドのオプションには、以下のようなものがあります。

|オプション|説明|
|---|---|
|`-h`|人間に読みやすい形式でサイズを表示（KB、MB、GBなどの単位）。|
|`-s`|指定したディレクトリの合計サイズのみを表示。|
|`-S`|サブディレクトリを含めずに計算|
|`-a`|ファイルとディレクトリのサイズを表示。デフォルトではディレクトリのみを表示。|
|`-c`|合計サイズを表示。|
|`-k`|サイズをキロバイト単位で表示。|
|`-m`|サイズをメガバイト単位で表示。|
|`-g`|サイズをギガバイト単位で表示。|

例えば、サイズを読みやすいようにするには、”-h”オプションを指定します。

```bash
du -h /etc
```

コマンドを実行すると、サイズの部分に単位が表示されるようになりました。  
![[Pasted image 20250912010524.png]]

また、ディレクトリを指定しないと、カレントディレクトリ配下のディレクトリを表示します。

```bash
du
```

コマンドを実行すると、隠しファイルなども表示されるので多くのディレクトリが表示されます。

ファイルを含めて表示させたい場合は、”-a”オプションを指定します。

```bash
du -a
```

コマンドを実行すると、ファイルまで表示されました。
![[Pasted image 20250912010541.png]]

