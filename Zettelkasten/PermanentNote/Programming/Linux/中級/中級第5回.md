---
title: Linux講座中級第5回
AI:
published: 2025-09-09
description:
tags:
  - permanent-note
---
**Linux講座**
- https://engineer-ninaritai.com/infraacademy/course-category/linux/?loop_content_only=false&column_per_row=3&course_per_page=12&show_pagination=false&keyword=Linux%E4%B8%AD%E7%B4%9A&tutor-course-filter-category=57&course_order=oldest_first&course_filter=true&loop_content_only=false&column_per_row=3&course_per_page=12&show_pagination=false&current_page=1&action=tutor_course_filter_ajax

---
##### ログとは？

ここからは、ログについて解説します。

「ログ」という言葉を一度は聞いたことがあると思います。

ログとは、どのようなものでしょうか？基礎的な部分から解説します。

###### ログは情報を記録したもの

**ログとは、情報を記録したものです。**

Linuxでは、さまざまなイベントが発生します。例えば、”システムが起動した”や”システムにエラーが発生した”といったさまざまなイベントがあります。

これらの情報をログとして記録して保存しておきます。

![[Pasted image 20250909130633.png]]

**ログは、システム監視や不具合の問題解決などのために利用されます。**

いつ何が起きたのかを記録しておくことで、システム管理者はログからさまざまな状況を知ることができます。

トラブルやエラーが発生した際は、必ずログを確認するようにしましょう。

今回の講座では、ログの見方などを含めてログについて解説します。

##### ログの格納場所

ログは、Linuxのイベントなどさまざまな情報を保存するものです。

では、そのログはどこに保存されているのでしょうか？

**ログファイルは、/var/logディレクトリ配下に保存されています。**

確認してみましょう。

まず、[シミュレーターを起動](https://terminal.engineer-ninaritai.com/)して、Debianを使うようにします。  
シミュレーターのディストリビューションでは、ログの出力方法が違うので、一般的なDebianを今回は使用します。

```bash
docker run -it debian /bin/bash
```

そして、以下のコマンドを実行しましょう。

```bash
ls /var/log
```

コマンドを実行すると、以下のように表示されます。
![[Pasted image 20250909130740.png]]

**/var/log/ディレクトリにあるものがログファイルになります。**

---
##### ログを監視するコマンド

続いて、ログを監視するコマンドついて解説します。

ログを見るときは、tailコマンドを使います。

###### tailコマンド

ファイルの中身を確認する場合、catコマンドがあります。

catコマンドの場合、ファイルの中身を出力するだけなので、出力した後の情報を見ることができません。

**継続的にログファイルの中身を監視したい場合はtailコマンドを使用します。**

“-f”オプションを付けて、ファイル名を指定します。

```bash
tail -f [ログファイル]
```

tailコマンドを使うことで、常にファイルを表示し続け、  
ログが追加されると画面にもリアルタイムで表示されます。

後ほど、ログの出力設定をしたら実践でtailコマンドを使用します。

---
##### rsyslogのインストール

ここからは、ログの出力設定を行います。

ログの設定を行うためには、rsyslogパッケージをインストールします。

###### rsyslogのインストール

まず[シミュレーター](https://terminal.engineer-ninaritai.com/)を起動して、Debianとして起動させます。  
(↓Debianで起動していない方のみ実行)

```bash
docker run -it debian /bin/bash
```

そして、rsyslogをインストールします。ファイル編集用にviコマンド、systemctlコマンドも同時にインストールします。

```bash
apt-get update
apt-get install rsyslog systemctl vim
```

systemctlコマンドはrsyslogを再起動や停止させるために使用します。  
続いて、rsyslogの設定ファイルの編集を行います。

---
##### ログファイルの設定

ログファイルの設定は、**/etc/rsyslog.conf**ファイルで行います。

このファイルには、**どこにどのようなログを出力するのかを設定します。**

###### rsyslog.confの編集

rsyslog.confの編集を行います。以下のコマンドを実行しましょう。

```bash
vi /etc/rsyslog.conf
```

ファイルの中盤にRULEと記載された部分があります。

![[Pasted image 20250909131642.png]]

この部分で、ログの出力設定をしています。

上記画面の赤線の部分は、**全てのログを/var/log/syslogに出力するという設定がされています。**

設定はそのままで、デフォルトの設定のままログを出力してみましょう。

###### rsyslogの起動

インストールした状態では、rsyslogは停止しております。

rsyslogを起動させる必要があります。rsyslogは以下のコマンドで起動します。

```bash
systemctl start rsyslog
```

コマンドを実行すると、先ほどの/var/log配下にsyslogファイルなどが生成されます。

以下のコマンドを実行して、syslogファイルを確認してみましょう。

```bash
tail -f /var/log/syslog
```

syslogファイルは全てのログを出力します。先ほどのrsyslogの起動のログも残っていることがわかります。
![[Pasted image 20250909131857.png]]

---
##### ファシリティ、プライオリティ

前回は、rsyslogを設定てログファイルを出力させました。

今回は、rsyslogファイルの設定について詳しく解説します。

###### rsyslog.confの構文

rsyslog.confでログの出力設定をする場合は、以下のように設定します。

```bash
[ファシリティ].[プライオリティ]     [ログの出力先]
```

**まずは、ファシリティ、プライオリティとは何なのかについて詳しく解説します。**

###### ファシリティとは？

**ファシリティとは、メッセージの出力元です。**  
ログの種類のことです。具体的には、カーネルや実行中のプロセスになります。

**ファシリティには、以下のようなものがあります。**

|   |   |
|---|---|
|auth, authpriv|認証システム|
|cron|クーロン|
|daemon|デーモン|
|kern|カーネル|
|lpr|印刷システム|
|mail|メールシステム|
|syslog|syslog機能|
|local0 – local7|独自の設定|

「 * 」を使うと全てのファシリティという意味になります。

###### プライオリティとは？

**プライオリティとは、メッセージの優先度です。**  
エラーのレベルやシステムの情報などのログを分類することができます。

プライオリティは以下のようなものがあります。

|   |   |
|---|---|
|emerg|危機的状況|
|alert|早急に対処が必要|
|crit|危険な状態|
|error|エラー|
|warning|警告|
|notice|重要な通知|
|info|システムからの情報|
|debug|デバッグ情報|
|none|ファシリティは無効|

「 * 」を使うと全てのプライオリティという意味になります。  
**上からプライオリティが高いものとなり、システムの重要な順でログを表示します。**

###### (参考)セミコロンの意味

syslogファイルの設定は、ファシリティとプライオリティが以下のように設定されていました。

![](https://engineer-ninaritai.com/infraacademy/wp-content/uploads/2023/10/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88-2023-10-23-12.45.07-300x18.png)

プライオリティの横には、 [***;auth,authpriv.none**]と特殊な設定がされています。

この部分はどのような意味があるのでしょうか？

**セミコロンは、条件を分割する役割があります。**

今回の場合、/var/log/syslogへのログは、**[*.*]**と**[auth,authpriv.none]**の2つの条件に当てはまるログが出力されます。

[*.*]は全てのファシリティとプライオリティが当てはまります。

[auth,authpriv.none]は**ファシリティauthおよびauthpriv**に対して**プライオリティnoneのメッセージを除外**する意味です。noneプライオリティは、特定のプライオリティを無効にするために使用され、ログメッセージが記録されないことを意味します。

つまり、ファシリティがauthとauthpriv以外は/var/log/syslogに記録されます。

---
##### ログの出力先の変更

ログの出力先の変更は、/etc/rsyslog.confを変更します。

ログの出力先は、以下の赤枠の部分を変更します。
![[Pasted image 20250909132227.png]]

###### 出力先の設定方法

出力先には、以下のものが設定できます。

|   |   |
|---|---|
|ファイル名|ファイルにログを出力する|
|＠[ホスト名]|リモートのホストにsyslogを出力する|
|ユーザー名|ユーザーの端末にログを出力する  <br>＊を指定すると全ユーザーに出力|
|/dev/console|コンソールに出力する|

また、**ファイル名の先頭に「-」を付けると、書き込み後に記憶しなくなります。**

書き込み負荷が下がりますが、障害が発生した場合にログが残らなくなる可能性があるので注意しましょう。

###### 設定例

ここでいくつかの設定例を見てみましょう。

例えば、メールファシリティのログを/var/log/mailに出力する場合は以下のように設定します。

```bash
mail.*          /var/log/mail
```

ファシリティがdaemonで、info以上のログを/var/log/daemonに出力する場合は以下のように設定します。

```bash
daemon.info      /var/log/daemon
```

全てのエラー情報をサーバー192.168.1.1に転送する場合は以下のように設定します。

```bash
*.*       @192.168.1.1
```

このようにログの出力設定を行います。

---
##### loggerコマンドでログを出力する

ここからは、logを出力するloggerコマンドについて学習します。

###### loggerコマンドの使い方

**loggerコマンドは、ログを出力するコマンドです。**

**基本的な使い方は以下の通りです。**

```bash
logger -p [ファシリティ].[プライオリティ] "[ログメッセージ]"
```

(※上記はsyslogがインストールされた状態で実行しましょう。[インストール方法はこちら](https://engineer-ninaritai.com/infraacademy/courses/system-log/lesson/rsyslog%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab/))

ログはシステム系のイベントなどは自動で収集することができますが、

loggerコマンドを使うことで自分でログを生成することもできます。

**loggerコマンドを試してみましょう。**

```bash
logger -p syslog.info "Hello log message"
```

上記のコマンドを実行すると、syslogファイルにログが表示されます。

以下のコマンドを実行して確認してみましょう。

```bash
tail /var/log/syslog
```

コマンドを実行すると、loggerコマンドのメッセージがログとして表示されています。

---
##### ログのローテーション

前回まで、rsyslogの設定を行いました。

ここではログのローテーションについて解説します。

###### ログのローテーションとは？

**ログのファイルは、情報が溜まっていく一方なので容量が大きくなります。**

そこで、**ローテーション機能を使って、ファイルを分割します。**

ログファイルを分割することでサイズの肥大化を防ぐことができます。
![[Pasted image 20250909133716.png]]

###### ログローテーションの設定

ログローテーションの設定は、/etc/logrotate.confもしくは/etc/logrotate.d/ディレクトリで設定します。

/etc/logrotate.d/ディレクトリに〇〇.confのファイルを作成すると、自動で設定が読み込まれます。

設定ファイルの中身を見てみましょう。(logrotate.dディレクトリ配下のファイルなら、どのファイルでも大丈夫です。)

```bash
cat /etc/logrotate.d/rsyslog
```

コマンドを実行すると、ログローテーションの設定があります。

![[Pasted image 20250909133749.png]]

**ログローテーションの設定では、ログファイルを指定して、どのようにローテーションするのかを設定します。**

例えば、”rotate 4″のようにどのくらいファイルを残すのかを設定し、”weekly”のようにどのタイミングでローテーションするのかを決めます。

### 参考: ローテーションの設定値

ローテーションの設定は、以下のように設定します。

```plain
[ログファイル] {
 設定値
}
```

例えば、syslogファイルを毎日ローテーションさせて、７つのファイルを残す場合は、以下のように設定します。

```plain
/var/log/syslog {
  rotate 7
  daily
}
```

その他にもさまざまな設定をすることができます。

設定値については、以下の表を参考にしてください。

|                      |                                                                            |
| -------------------- | -------------------------------------------------------------------------- |
| compress             | ローテーションしたログをgzipで圧縮                                                        |
| copytruncate         | ログファイルをコピーし、内容を削除                                                          |
| create               | [パーミッション ユーザー名 グループ名] ローテーション後に空のログファイルを新規作成。ファイルのパーミッション、ユーザー名、グループ名を指定可能 |
| daily                | ログを毎日ローテーションする                                                             |
| delaycompress        | ログの圧縮作業を次回のローテーション時まで遅らせる。compressと共に指定                                    |
| ifempty              | ログファイルが空でもローテーションする                                                        |
| missingok            | ログファイルが存在しなくてもエラーを出さずに処理を続行                                                |
| monthly              | ログを毎月ローテーションする                                                             |
| nocompress           | ローテーションしたログを圧縮しない                                                          |
| nocreate             | 新たな空のログファイルを作成しない                                                          |
| nomissingok          | ログファイルが存在しない場合にエラーを出す                                                      |
| noolddir             | ローテーション対象のログと同じディレクトリにローテーションしたログを格納                                       |
| notifempty           | ログファイルが空ならローテーションしない                                                       |
| olddir [ディレクトリ名]     | 指定したディレクトリ内にローテーションしたログを格納                                                 |
| postrotate～endscript | postrotateとendscriptの間に記述されたコマンドをログローテーション後に実行                             |
| prerotate～endscript  | prerotateとendscriptの間に記述されたコマンドをログローテーション前に実行                              |
| rotate 回数            | ローテーションする回数を指定                                                             |
| size [ファイルサイズ]       | ログファイルが指定したファイルサイズ以上になったらローテーションする                                         |
| sharedscripts        | 複数指定したログファイルに対し、postrotateまたはprerotateで記述したコマンドを実行                         |
| weekly               | ログを毎週ローテーションする                                                             |
